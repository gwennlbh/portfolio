name: Build

on:
  workflow_call:
    inputs:
      artifact:
        type: string
        description: Name of the artifact to upload
        required: true
      lang:
        type: string
        description: Language code (e.g. "en" or "fr")
        required: true
      locale:
        type: string
        description: Locale code (e.g. "en-US" or "fr-FR")
        required: true
      build-commit:
        type: string
        description: Set BUILD_COMMIT
        required: false
        default: ${{ github.sha }}

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v5
      - name: Setup Bun
        uses: oven-sh/setup-bun@v2
        with:
          bun-version-file: .bun-version
      - name: Install dependencies
        run: bun install --frozen-lockfile
      - name: Build site
        run: bun run build
        env:
          LANG: ${{ inputs.lang }}
          LOCALE: ${{ inputs.locale }}
          BUILD_COMMIT: ${{ inputs.build-commit }}
      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with:
          name: ${{ inputs.artifact }}
          path: dist
